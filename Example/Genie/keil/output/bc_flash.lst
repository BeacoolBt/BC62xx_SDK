   1              		.syntax unified
   2              		.cpu cortex-m0
   3              		.fpu softvfp
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 4
  11              		.eabi_attribute 34, 0
  12              		.eabi_attribute 18, 4
  13              		.thumb
  14              		.syntax unified
  15              		.file	"bc_flash.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.align	1
  20              		.global	bc_flash_erase
  21              		.code	16
  22              		.thumb_func
  24              	bc_flash_erase:
  25              	.LFB41:
  26              		.file 1 "../../../drivers/hal/bc_flash.c"
   1:../../../drivers/hal/bc_flash.c **** 
   2:../../../drivers/hal/bc_flash.c **** #include "bc_flash.h"
   3:../../../drivers/hal/bc_flash.c **** #include "flash_config.h"
   4:../../../drivers/hal/bc_flash.c **** #include "bc62xx_flash.h"
   5:../../../drivers/hal/bc_flash.c **** 
   6:../../../drivers/hal/bc_flash.c **** #ifndef RELEASE
   7:../../../drivers/hal/bc_flash.c **** #define RELEASE
   8:../../../drivers/hal/bc_flash.c **** #endif
   9:../../../drivers/hal/bc_flash.c **** 
  10:../../../drivers/hal/bc_flash.c **** #define APP_START_ADDR			(SECTION_START_ADDR+SECTION_SIZE*SECTION_NUM)
  11:../../../drivers/hal/bc_flash.c **** #define APP_SIZE				(FLASH_START_ADDR+FLASH_SIZE-APP_START_ADDR)
  12:../../../drivers/hal/bc_flash.c **** 
  13:../../../drivers/hal/bc_flash.c **** uint32_t bc_flash_erase(uint32_t addr, uint32_t page_cnt)
  14:../../../drivers/hal/bc_flash.c **** {
  27              		.loc 1 14 0
  28              		.cfi_startproc
  29              		@ args = 0, pretend = 0, frame = 0
  30              		@ frame_needed = 0, uses_anonymous_args = 0
  31              	.LVL0:
  15:../../../drivers/hal/bc_flash.c **** 
  16:../../../drivers/hal/bc_flash.c **** 	if((addr&(PAGE_SIZE-1))!= 0 && (addr+PAGE_SIZE*page_cnt)>APP_SIZE)
  32              		.loc 1 16 0
  33 0000 C3B2     		uxtb	r3, r0
  14:../../../drivers/hal/bc_flash.c **** 
  34              		.loc 1 14 0
  35 0002 70B5     		push	{r4, r5, r6, lr}
  36              	.LCFI0:
  37              		.cfi_def_cfa_offset 16
  38              		.cfi_offset 4, -16
  39              		.cfi_offset 5, -12
  40              		.cfi_offset 6, -8
  41              		.cfi_offset 14, -4
  14:../../../drivers/hal/bc_flash.c **** 
  42              		.loc 1 14 0
  43 0004 0400     		movs	r4, r0
  44 0006 0D00     		movs	r5, r1
  45              		.loc 1 16 0
  46 0008 002B     		cmp	r3, #0
  47 000a 06D0     		beq	.L2
  48              		.loc 1 16 0 is_stmt 0 discriminator 1
  49 000c D022     		movs	r2, #208
  50 000e 0B02     		lsls	r3, r1, #8
  51 0010 1B18     		adds	r3, r3, r0
  52 0012 5201     		lsls	r2, r2, #5
  17:../../../drivers/hal/bc_flash.c **** 		return 1;
  53              		.loc 1 17 0 is_stmt 1 discriminator 1
  54 0014 0120     		movs	r0, #1
  55              	.LVL1:
  16:../../../drivers/hal/bc_flash.c **** 		return 1;
  56              		.loc 1 16 0 discriminator 1
  57 0016 9342     		cmp	r3, r2
  58 0018 0ED8     		bhi	.L3
  59              	.L2:
  18:../../../drivers/hal/bc_flash.c **** 	addr += APP_START_ADDR;
  60              		.loc 1 18 0
  61 001a 084B     		ldr	r3, .L12
  62              	.LBB2:
  19:../../../drivers/hal/bc_flash.c **** #ifndef RELEASE
  20:../../../drivers/hal/bc_flash.c **** 		printf( "erase data addr=0x%08x\r\n", addr);
  21:../../../drivers/hal/bc_flash.c **** #endif
  22:../../../drivers/hal/bc_flash.c **** 	QSPI_Init();
  23:../../../drivers/hal/bc_flash.c **** 	for(int i = 0; i < page_cnt; ++i){
  63              		.loc 1 23 0
  64 001c 0026     		movs	r6, #0
  65              	.LBE2:
  18:../../../drivers/hal/bc_flash.c **** 	addr += APP_START_ADDR;
  66              		.loc 1 18 0
  67 001e E418     		adds	r4, r4, r3
  68              	.LVL2:
  22:../../../drivers/hal/bc_flash.c **** 	for(int i = 0; i < page_cnt; ++i){
  69              		.loc 1 22 0
  70 0020 FFF7FEFF 		bl	QSPI_Init
  71              	.LVL3:
  72              	.L4:
  73              	.LBB3:
  74              		.loc 1 23 0 discriminator 1
  75 0024 AE42     		cmp	r6, r5
  76 0026 06D0     		beq	.L11
  24:../../../drivers/hal/bc_flash.c **** 		QSPI_PageEraseFlash(addr+i*PAGE_SIZE);
  77              		.loc 1 24 0 discriminator 3
  78 0028 2000     		movs	r0, r4
  79 002a 0134     		adds	r4, r4, #1
  80 002c FFF7FEFF 		bl	QSPI_PageEraseFlash
  81              	.LVL4:
  23:../../../drivers/hal/bc_flash.c **** 		QSPI_PageEraseFlash(addr+i*PAGE_SIZE);
  82              		.loc 1 23 0 discriminator 3
  83 0030 0136     		adds	r6, r6, #1
  84              	.LVL5:
  85 0032 FF34     		adds	r4, r4, #255
  86 0034 F6E7     		b	.L4
  87              	.L11:
  88              	.LBE3:
  25:../../../drivers/hal/bc_flash.c **** 	}
  26:../../../drivers/hal/bc_flash.c **** 	return 0;	
  89              		.loc 1 26 0
  90 0036 0020     		movs	r0, #0
  91              	.LVL6:
  92              	.L3:
  27:../../../drivers/hal/bc_flash.c **** }
  93              		.loc 1 27 0
  94              		@ sp needed
  95              	.LVL7:
  96 0038 70BD     		pop	{r4, r5, r6, pc}
  97              	.L13:
  98 003a C046     		.align	2
  99              	.L12:
 100 003c 00E60700 		.word	517632
 101              		.cfi_endproc
 102              	.LFE41:
 104              		.align	1
 105              		.global	bc_flash_read
 106              		.code	16
 107              		.thumb_func
 109              	bc_flash_read:
 110              	.LFB42:
  28:../../../drivers/hal/bc_flash.c **** 
  29:../../../drivers/hal/bc_flash.c **** uint32_t bc_flash_read(uint32_t addr, uint32_t len, uint8_t* buf)
  30:../../../drivers/hal/bc_flash.c **** {
 111              		.loc 1 30 0
 112              		.cfi_startproc
 113              		@ args = 0, pretend = 0, frame = 0
 114              		@ frame_needed = 0, uses_anonymous_args = 0
 115              	.LVL8:
 116 0040 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 117              	.LCFI1:
 118              		.cfi_def_cfa_offset 24
 119              		.cfi_offset 3, -24
 120              		.cfi_offset 4, -20
 121              		.cfi_offset 5, -16
 122              		.cfi_offset 6, -12
 123              		.cfi_offset 7, -8
 124              		.cfi_offset 14, -4
 125              		.loc 1 30 0
 126 0042 0500     		movs	r5, r0
 127 0044 0E00     		movs	r6, r1
 128 0046 1700     		movs	r7, r2
  31:../../../drivers/hal/bc_flash.c **** 	if(len < 1 ||(((addr+len-1)&PAGE_MASK) != ((addr)&PAGE_MASK)) || buf == NULL){
  32:../../../drivers/hal/bc_flash.c **** 		return 1;
 129              		.loc 1 32 0
 130 0048 0124     		movs	r4, #1
  31:../../../drivers/hal/bc_flash.c **** 	if(len < 1 ||(((addr+len-1)&PAGE_MASK) != ((addr)&PAGE_MASK)) || buf == NULL){
 131              		.loc 1 31 0
 132 004a 0029     		cmp	r1, #0
 133 004c 11D0     		beq	.L15
  31:../../../drivers/hal/bc_flash.c **** 	if(len < 1 ||(((addr+len-1)&PAGE_MASK) != ((addr)&PAGE_MASK)) || buf == NULL){
 134              		.loc 1 31 0 is_stmt 0 discriminator 1
 135 004e FF23     		movs	r3, #255
 136 0050 441E     		subs	r4, r0, #1
 137 0052 6418     		adds	r4, r4, r1
 138 0054 4440     		eors	r4, r0
 139 0056 9C43     		bics	r4, r3
 140 0058 0AD1     		bne	.L18
  31:../../../drivers/hal/bc_flash.c **** 	if(len < 1 ||(((addr+len-1)&PAGE_MASK) != ((addr)&PAGE_MASK)) || buf == NULL){
 141              		.loc 1 31 0 discriminator 2
 142 005a 002A     		cmp	r2, #0
 143 005c 08D0     		beq	.L18
 144              	.LVL9:
  33:../../../drivers/hal/bc_flash.c **** 	}
  34:../../../drivers/hal/bc_flash.c **** 	addr += APP_START_ADDR;
  35:../../../drivers/hal/bc_flash.c **** #ifndef RELEASE
  36:../../../drivers/hal/bc_flash.c **** 	printf("read addr=%08xx\r\n", addr);
  37:../../../drivers/hal/bc_flash.c **** #endif
  38:../../../drivers/hal/bc_flash.c **** 	QSPI_Init();
 145              		.loc 1 38 0 is_stmt 1
 146 005e FFF7FEFF 		bl	QSPI_Init
 147              	.LVL10:
  39:../../../drivers/hal/bc_flash.c **** 	QSPI_ReadFlashData(addr,len,buf);
 148              		.loc 1 39 0
 149 0062 054B     		ldr	r3, .L20
 150 0064 3A00     		movs	r2, r7
 151 0066 E818     		adds	r0, r5, r3
 152              	.LVL11:
 153 0068 3100     		movs	r1, r6
 154 006a FFF7FEFF 		bl	QSPI_ReadFlashData
 155              	.LVL12:
  40:../../../drivers/hal/bc_flash.c **** #ifndef RELEASE
  41:../../../drivers/hal/bc_flash.c **** 	for(int i = 0; i < len; ++i){
  42:../../../drivers/hal/bc_flash.c **** 		printf("%02x ", buf[i]);
  43:../../../drivers/hal/bc_flash.c **** 	}
  44:../../../drivers/hal/bc_flash.c **** 	printf("\r\n");
  45:../../../drivers/hal/bc_flash.c **** #endif
  46:../../../drivers/hal/bc_flash.c **** 
  47:../../../drivers/hal/bc_flash.c **** 	return 0;
 156              		.loc 1 47 0
 157 006e 00E0     		b	.L15
 158              	.LVL13:
 159              	.L18:
  32:../../../drivers/hal/bc_flash.c **** 	}
 160              		.loc 1 32 0
 161 0070 0124     		movs	r4, #1
 162              	.LVL14:
 163              	.L15:
  48:../../../drivers/hal/bc_flash.c **** }
 164              		.loc 1 48 0
 165 0072 2000     		movs	r0, r4
 166              		@ sp needed
 167              	.LVL15:
 168              	.LVL16:
 169 0074 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 170              	.L21:
 171 0076 C046     		.align	2
 172              	.L20:
 173 0078 00E60700 		.word	517632
 174              		.cfi_endproc
 175              	.LFE42:
 177              		.align	1
 178              		.global	bc_flash_write
 179              		.code	16
 180              		.thumb_func
 182              	bc_flash_write:
 183              	.LFB43:
  49:../../../drivers/hal/bc_flash.c **** 
  50:../../../drivers/hal/bc_flash.c **** uint32_t bc_flash_write(uint32_t addr, uint32_t len, uint8_t* buf)
  51:../../../drivers/hal/bc_flash.c **** {
 184              		.loc 1 51 0
 185              		.cfi_startproc
 186              		@ args = 0, pretend = 0, frame = 0
 187              		@ frame_needed = 0, uses_anonymous_args = 0
 188              	.LVL17:
 189 007c F8B5     		push	{r3, r4, r5, r6, r7, lr}
 190              	.LCFI2:
 191              		.cfi_def_cfa_offset 24
 192              		.cfi_offset 3, -24
 193              		.cfi_offset 4, -20
 194              		.cfi_offset 5, -16
 195              		.cfi_offset 6, -12
 196              		.cfi_offset 7, -8
 197              		.cfi_offset 14, -4
 198              		.loc 1 51 0
 199 007e 0500     		movs	r5, r0
 200 0080 0E00     		movs	r6, r1
 201 0082 1700     		movs	r7, r2
  52:../../../drivers/hal/bc_flash.c **** 	if(len < 1 || (((addr+len-1)&PAGE_MASK) != ((addr)&PAGE_MASK))|| buf == NULL){
  53:../../../drivers/hal/bc_flash.c **** 		return 1;
 202              		.loc 1 53 0
 203 0084 0124     		movs	r4, #1
  52:../../../drivers/hal/bc_flash.c **** 	if(len < 1 || (((addr+len-1)&PAGE_MASK) != ((addr)&PAGE_MASK))|| buf == NULL){
 204              		.loc 1 52 0
 205 0086 0029     		cmp	r1, #0
 206 0088 11D0     		beq	.L23
  52:../../../drivers/hal/bc_flash.c **** 	if(len < 1 || (((addr+len-1)&PAGE_MASK) != ((addr)&PAGE_MASK))|| buf == NULL){
 207              		.loc 1 52 0 is_stmt 0 discriminator 1
 208 008a FF23     		movs	r3, #255
 209 008c 441E     		subs	r4, r0, #1
 210 008e 6418     		adds	r4, r4, r1
 211 0090 4440     		eors	r4, r0
 212 0092 9C43     		bics	r4, r3
 213 0094 0AD1     		bne	.L26
  52:../../../drivers/hal/bc_flash.c **** 	if(len < 1 || (((addr+len-1)&PAGE_MASK) != ((addr)&PAGE_MASK))|| buf == NULL){
 214              		.loc 1 52 0 discriminator 2
 215 0096 002A     		cmp	r2, #0
 216 0098 08D0     		beq	.L26
 217              	.LVL18:
  54:../../../drivers/hal/bc_flash.c **** 	}
  55:../../../drivers/hal/bc_flash.c **** 	addr += APP_START_ADDR;
  56:../../../drivers/hal/bc_flash.c **** #ifndef RELEASE
  57:../../../drivers/hal/bc_flash.c **** 	printf("write addr = %08x\r\n", addr);
  58:../../../drivers/hal/bc_flash.c **** #endif
  59:../../../drivers/hal/bc_flash.c **** 	QSPI_Init();
 218              		.loc 1 59 0 is_stmt 1
 219 009a FFF7FEFF 		bl	QSPI_Init
 220              	.LVL19:
  60:../../../drivers/hal/bc_flash.c **** 	QSPI_WriteFlashData(addr,len,buf);
 221              		.loc 1 60 0
 222 009e 054B     		ldr	r3, .L28
 223 00a0 3A00     		movs	r2, r7
 224 00a2 E818     		adds	r0, r5, r3
 225              	.LVL20:
 226 00a4 3100     		movs	r1, r6
 227 00a6 FFF7FEFF 		bl	QSPI_WriteFlashData
 228              	.LVL21:
  61:../../../drivers/hal/bc_flash.c **** #ifndef RELEASE
  62:../../../drivers/hal/bc_flash.c **** 	printf("write end\r\n");
  63:../../../drivers/hal/bc_flash.c **** #endif
  64:../../../drivers/hal/bc_flash.c **** 	return 0;
 229              		.loc 1 64 0
 230 00aa 00E0     		b	.L23
 231              	.LVL22:
 232              	.L26:
  53:../../../drivers/hal/bc_flash.c **** 	}
 233              		.loc 1 53 0
 234 00ac 0124     		movs	r4, #1
 235              	.LVL23:
 236              	.L23:
  65:../../../drivers/hal/bc_flash.c **** }
 237              		.loc 1 65 0
 238 00ae 2000     		movs	r0, r4
 239              		@ sp needed
 240              	.LVL24:
 241              	.LVL25:
 242 00b0 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 243              	.L29:
 244 00b2 C046     		.align	2
 245              	.L28:
 246 00b4 00E60700 		.word	517632
 247              		.cfi_endproc
 248              	.LFE43:
 250              	.Letext0:
 251              		.file 2 "d:\\meshstack\\bc6218\\tools\\gcc-arm-none-eabi-5_4-2016q3-20160926-win32\\arm-none-eabi\
 252              		.file 3 "d:\\meshstack\\bc6218\\tools\\gcc-arm-none-eabi-5_4-2016q3-20160926-win32\\arm-none-eabi\
 253              		.file 4 "../../../drivers/hal/inc/bc62xx_flash.h"
